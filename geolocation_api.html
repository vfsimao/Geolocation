<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head id="Head1" runat="server">
    <title></title>
    <script src="http://code.jquery.com/jquery-1.8.1.js" type="text/javascript"></script>
    <script type="text/javascript">
        function CalculaRota() {
            var urlDirections = "http://maps.googleapis.com/maps/api/directions/json?origin={0}&destination={1}&mode=driving&language=pt-BR&sensor=false";
            //Adicionar endereço de origem
            urlDirections = urlDirections.replace("{0}", $("#txtOrigem").val());
            //Adicionar endereço de destino
            urlDirections = urlDirections.replace("{1}", $("#txtDestino").val());

            $('#litResultado').html('Aguarde...');
            $.getJSON("webservice.ashx?url=" + escape(urlDirections ),
              function (data) {
                  //Verificar se o Status está OK
                  if (data.status == "OK") {
                      var rota = "";
                      for (var i = 0; i < data.routes[0].legs[0].steps.length; i++) {
                          //Pegar as instruções da rota em HTML
                          rota += data.routes[0].legs[0].steps[i].html_instructions + "<br />";
                          //Pegar a distância deste trecho
                          rota += data.routes[0].legs[0].steps[i].distance.text + "<br />";
                      }
                      //Retornar o resultado na página
                      $('#litResultado').html(
                          //Pegar endereço de origem
                          "<strong>Origem</strong>: " + data.routes[0].legs[0].start_address +
                          //Pegar endereço de destino
                          "<br /><strong>Destino:</strong> " + data.routes[0].legs[0].end_address +
                          //Pegar a distância
                          "<br /><strong>Distância</strong>: " + data.routes[0].legs[0].distance.text +
                          //Pegar duração
                          " <br /><strong>Duração</strong>: " + data.routes[0].legs[0].duration.text +
                          //Adicionar a rota gerada logo acima
                          " <br /><strong>Como chegar ao destino</strong>:<br /> " + rota
                          );
                      //Atualizar o mapa
                      $("#map").attr("src", "https://maps.google.com/maps?saddr=" + data.routes[0].legs[0].start_address +"&daddr=" + data.routes[0].legs[0].end_address + "&output=embed");
                  }
                //Se o Status não for OK
                  else
                      $('#litResultado').html('Ocorreu um erro');

              }
            ).error(function () { $('#litResultado').html('Ocorreu um erro!'); });
        }
    </script>
</head>
<body>
    <form id="form1" runat="server">

        <div>
            <div>
                <table border="0" cellpadding="0" cellspacing="0">
                    <tr>
                        <td>
                            <label for="txtOrigem">Origem</label>
                            <input type="text" id="txtOrigem" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label for="txtDestino">Destino</label>
                            <input type="text" id="txtDestino" />
                        </td>
                    </tr>
                </table>
                <input type="button" value="Calcular distância" onclick="CalculaRota()" />
            </div>
        </div>
        <div style="padding:10px">
            <iframe id="map" width="750" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?saddr=porto+alegre&daddr=São paulo&amp;output=embed"></iframe>
        </div>
        <span id="litResultado"></span>
    </form>
</body>
</html>